name: Docker Build & Run

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '0 11,23 * * *'

jobs:

  build:

    runs-on: ubuntu-latest
    environment: prod

    steps:
    - uses: actions/checkout@v4
    - name: Create env file
      run: |
        touch .env
        echo BOOKING_ID=${{ vars.BOOKING_ID }} >> .env
        echo SHIP_CODE=${{ vars.SHIP_CODE }} >> .env
        echo SAIL_DATE=${{ vars.SAIL_DATE }} >> .env
        echo MAIL_PASSWORD=${{ vars.MAIL_PASSWORD }} >> .env
        echo MAIL_SENDER=${{ vars.MAIL_SENDER }} >> .env
        echo MAIL_RECIPIENTS=${{ vars.MAIL_RECIPIENTS }} >> .env
    - name: Build the Docker image
      run: docker build -t jkaisix/rc-webscraper
    - name: Run container
      run: docker run --env-file .env jkaisix/rc-webscraper
